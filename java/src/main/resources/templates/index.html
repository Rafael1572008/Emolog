<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" href="/css/home.css">
</head>

<body>

<div class="botoes-navegacao">
    <a class="btn" href="/estatisticas">
        <img src="/imagens/Botao_de_Estatisticas.webp" width="80px" height="80px">
    </a>
    <a class="btn" href="/tag">
        <img src="/imagens/Botao_de_Tag.webp" width="80px" height="80px">
    </a>
</div>

<div class="container">
    <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu(this)">⋮</button>
        <div class="menu-content">
            <a class="btn-menu" href="/alterarsenha">Alterar senha</a>
            <a class="btn-menu" href="/usuario/logout">Sair</a>
        </div>
    </div>

    <div class="home-box">

        <h1>Seus Registros</h1>

        <div class="historico-humor">
            <div class="sem-registros" th:if="${#lists.isEmpty(registros)}">
                Não há registros de humor.
            </div>


            <div class="humor-item" th:each="h : ${registros}">

                <div class="humor-top">

                    <div class="dataHora" th:text="${#temporals.format(h.dataHora, 'dd/MM/yyyy HH:mm')}"></div>

                    <div class="humor-acoes">
                        <img src="/imagens/Botao_de_Edicao.webp"
                             alt="Editar"
                             class="btn-editar"
                             th:data-id="${h.id}"
                             th:data-texto="${h.texto != null ? h.texto : ''}"
                             data-id=""
                             data-texto=""
                             style="cursor:pointer; width:60px; height:60px;">

                        <button onclick="mostrarTexto(this)" class="btn-texto" style="background:none;border:none;padding:0;">
                            <img src="/imagens/Botao_de_Notas.webp" alt="Texto">
                        </button>

                        <button class="btn-delete" type="button"
                                th:onclick="'excluirHumor(' + ${h.id} + ')'">
                            <img src="/imagens/Botao_de_Excluir.png" alt="Excluir">
                        </button>
                    </div>


                </div>

                <div class="tags" th:if="${h.tags != null and !h.tags.isEmpty()}">
                    <span class="tag" th:each="tg : ${h.tags}" th:text="${tg}"></span>
                </div>

                <div class="humor-display">
                    <img th:src="${'/imagens/' + h.humor.imagem}" alt="Humor">
                    <span th:text="${h.humor.name()}"></span>
                </div>

                <div class="texto-humor"
                     style="display:none; margin-top:10px; font-size:14px; color:#ddd;"
                     th:text="${h.texto}"
                     th:data-humor-id="${h.id}"
                     data-humor-id="">
                </div>

            </div>

        </div>

        <div class="botoes-tags">
            <a class="botao-tags" href="/tags/criar">Adicionar nova tag</a>
            <a class="botao-tags" href="/tags/aplicar">Aplicar tags aos registros</a>
        </div>

        <a class="btn" href="/registrarHumor">
            <img src="/imagens/Botao_de_Mais.webp" width="100px" height="100px">
        </a>

    </div>
</div>

<!-- Modal de Edição de Texto -->
<div id="modalEditarTexto" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Editar anotação</h2>
            <span class="fechar-modal" onclick="fecharModal()">&times;</span>
        </div>

        <form id="formEditarTexto">
            <textarea
                    id="textoEditado"
                    placeholder="Escreva aqui sua anotação..."
                    maxlength="500"
                    rows="6"></textarea>

            <div class="modal-actions">
                <button type="button" class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
                <button type="submit" class="btn-salvar">Salvar</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/js/menu.js}"></script>

<script>
    function mostrarTexto(botao) {
        const bloco = botao.closest(".humor-item").querySelector(".texto-humor");
        if (bloco.style.display === "none") {
            bloco.style.display = "block";
        } else {
            bloco.style.display = "none";
        }
    }
</script>

</body>
</html>
